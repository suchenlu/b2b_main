<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link href="../../../static/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <!-- <link href="../../../static/css/bootstrap-theme.min.css" rel="stylesheet" media="screen"> -->
    <link rel="stylesheet" type="text/css" href="../../../static/css/base.css"/>
    <link rel="shortcut icon" type="image/x-icon" href="../../../static/img/logo2.png" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

<style>
    input{overflow: hidden;}
    input[type="file"]{width: 100%;}
    .return{margin:0 auto;}
</style>

  </head>
  <body id="B2B" >
    

  <div class="container-fluid">
    <div class="row-fluid">
        <ul class="nav">
            <li class="active"><a>上传产品</a></li>
        </ul>
        <a class="btn pull-right" href="javascript:;">上传产品</a>
    </div>
    
    <div class="product_picture ">
       <div class="main_picture">
           <div class="main_picture_left"><span>主图</span></div>
           <div class="main_picture_right">
               <p><a href="javascript:;">+</a></p>
               <h4>支持jpg、png、gif格式可上传一张图片</h4>
           </div>
       </div>
       <div class="main_picture">
           <div class="main_picture_left"><span>轮播图</span></div>
           <div class="main_picture_right">
               <ul>
                   <li><a href="javascript:;">+</a></li>
                   <li><a href="javascript:;">+</a></li>
                   <li><a href="javascript:;">+</a></li>
                   <li><a href="javascript:;">+</a></li>
               </ul>
               <h4>支持jpg、png、gif格式最多支持四张图片</h4>
           </div>
       </div>
       <div class="main_picture">
           <div class="main_picture_left"><span>行程图</span></div>
           <div class="main_picture_right">
               <p><a href="javascript:;">+</a></p>
               <h4>支持jpg、png、gif格式可上传一张图片</h4>
           </div>
       </div>
    </div>
    <div class="picture_btn">
        <div class="return">
          <input  class="btn" type="submit" value="提&nbsp;&nbsp;交" />&nbsp;&nbsp;
          <a class="button" href="/manage/wares/list/1/100"> 返&nbsp;&nbsp;回 </a>
        </div>
    </div>
</div>


<script src="../../../static/js/jquery.js"></script>
<script src="../../../static/js/bootstrap.min.js"></script>

<script>
    $(document).ready(function() {

        upimg('main_pic');
        upimg('lunbo_1');
        upimg('lunbo_2');
        upimg('lunbo_3');
        upimg('lunbo_4');
        
        upimg('xingcheng_main_1')
        upimg('xingcheng_mini_1')
        
    });
</script>

<script >
    function checkImgType(ths){
        if (ths.value == "") {
            alert("请上传图片");
            return false;
        } else {
            if (!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(ths.value)) {
                alert("图片类型必须是.gif,jpeg,jpg,png中的一种");
                ths.value = "";
                return false;
            }

            else
            {
                var img=new Image();
                img.src=filepath;
                while(true){
                    if(img.fileSize>0){
                        if(img.fileSize>2*1024){
                            alert("图片不大于10M。");
                            return false;
                        }
                        break;
                    }

                }
            }
        }
        return true;
    }

    function upimg(id) {
        // alert(id);
        var hi = $("#" + id + '_hid').val();
        if (hi != '') {
            $("#" + id + "_img").attr('src', hi);
        }

        $("#" + id).change(function () {
            filepath = $('#'+ id).val();
            target = this;
            var extStart=filepath.lastIndexOf(".");

            var ext=filepath.substring(extStart,filepath.length).toUpperCase();

            if(ext!=".PNG"&&ext!=".JPG"&&ext!=".JPEG"){
                alert("图片限于png,jpeg,jpg格式");
                return false;
            }

            var isIE = /msie/i.test(navigator.userAgent) && !window.opera;

            var fileSize = 0;
            if (isIE && !target.files){
                var filePath = target.value;
                var fileSystem = new ActiveXObject("Scripting.FileSystemObject");
                var file = fileSystem.GetFile (filePath);
                fileSize = file.Size;
            } else {
                fileSize = target.files[0].size;
            }

            var size = fileSize/(1024*1024);

            if (size >1){
                alert('图片尺寸不能大于1M');
                return false;
            }

            var data = new FormData();
            $.each($("#" + id)[0].files, function (i, file) {
                data.append('upload_file', file);
            });

            $.ajax({
                url: '/manage/wares/upimg',
                type: 'POST',
                data: data,
                cache: false,
                contentType: false,    //不可缺
                processData: false,    //不可缺
                success: function (data) {

                    if (data != '') {
                        $("#" + id + '_img').attr("src", data);
                        $("#" + id + '_hid').val(data);
                        //alert($("#" + id + '_hid').val());

                    }
                }
            });
        });
    }
</script>



  </body>
</html>
